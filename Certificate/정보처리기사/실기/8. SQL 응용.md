# 8. SQL 응용

## **Section 072. SQL - DDL**

1. **DDL(데이터 정의어)** : DB 구조, 데이터 형식, 접근 방식 등 DB를 구축/수정할 목적으로 사용하는 언어

2. **CREATE SCHEMA** : 스키마를 정의하는 명령문

   ```sql
   CREATE SCHEMA 스키마명 AUTHORIZATION 사용자_id;
   ```

3. **CREATE DOMAIN** : 도메인을 정의하는 명령문

   ```sql
   CREATE DOMAIN 도메인명 [AS] 데이터_타입
              [DEFAULT 기본값]
              [CONSTRAINT 제약조건명 CHECK (범위값)];
   ```

4. **CREATE TABLE** : 테이블을 정의하는 명령문

   ```sql
   CREATE TABLE 테이블명
              (속성명 데이터_타입 [DEFAULT 기본값] [NOT NULL], …
              [, PRIMARY KEY(기본키_속성명, …)]
              [, UNIQUE(대체키_속성명, …)]
              [, FOREIGN KEY(외래키_속성명, …)]
                        REFERENCES 참조테이블(기본키_속성명, …)]
                        [ON DELETE 옵션]
                        [ON UPDATE 옵션]
              [, CONSTRAINT 제약조건명] [CHECK (조건식)]);
   ```

5. **CREATE VIEW** : 뷰(View)를 정의하는 명령문

   ```sql
   CREATE VIEW 뷰명[(속성명[, 속성명, …])]
   AS SELETE문;
   ```

6. **CREATE INDEX** : 인덱스를 정의하는 명령문

   ```sql
   CREATE [UNIQUE] INDEX 인덱스명
   ON 테이블명(속성명 [ASC | DESC] [, 속성명 [ASC | DESC]])
   [CLUSTER];
   ```

7. **ALTER TABLE** : 테이블에 대한 정의를 변경하는 명령문

   ```sql
   ALTER TABLE 테이블명 ADD 속성명 테이터_타입 [DEFAULT '기본값'];
   ALTER TABLE 테이블명 ALTER 속성명 [SET DEFAULT '기본값'];
   ALTER TABLE 테이블명 DROP COLUMN 속성명 [CASCADE];
   ```

8. **DROP** : 스키마, 도메인, 기본 테이블, 뷰 테이블, 인덱스, 제약 조건 등을 제거하는 명령문

   ```sql
   DROP SCHEMA 스키마명 [CASCADE | RESTRICTED];
   DROP DOMAIN 도메인명 [CASCADE | RESTRICTED];
   DROP TABLE 테이블명 [CASCADE | RESTRICTED];
   DROP VIEW 뷰명 [CASCADE | RESTRICTED];
   DROP INDEX 인덱스명 [CASCADE | RESTRICTED];
   DROP CONSTRAINT 제약조건명;
   ```

<br/><br/>

## **Section 073. SQL - DCL**

1. **DCL(데이터 제어어)** : 데이터의 보안, 무결성, 회복, 병행 제어 등을 정의하는데 사용하는 언어

2. **GRANT / REVOKE**

   + **GRANT** : 권한 부여를 위한 명령어

   + **REVOKE** : 권한 취소를 위한 명령어

   + 사용자등급 지정 or 해제

     ```sql
     GRANT 사용자등급 TO 사용자_ID_리스트 [IDENTIFIED BY 암호];
     REVOKE 사용자등급 FROM 사용자_ID_리스트;
     ```

   + 테이블 및 속성에 대한 권한 부여 및 취소

     ```sql
     GRANT 권한_리스트 ON 개체 TO 사용자 [WITH GRANT OPTION];
     REVOKE [GRANT OPTION FOR] 권한_리스트 ON 개체 FROM 사용자 [CASCADE];
     ```

     + WITH GRANT OPTION : 부여 받은 권한을 다른 사용자에게 다시 부여할 수 있는 권한을 부여함
     + GRANT OPTION FOR : 다른 사용자에게 권한을 부여할 수 있는 권한을 취소함
     + CASCADE : 권한 취소 시 권한을 부여 받았던 사용자가 다른 사용자에게 부여한 권한도 연쇄적으로 취소함

3. **COMMIT** : 트랜잭션이 성공적으로 끝나면 DB가 새로운 일관성(Consistency) 상태를 가지기 위해 변경된 모든 내용을 DB에 반영해야함 -> 이 때 사용하는 명령어

4. **ROLLBACK** : 아직 COMMIT되지 않은 변경된 모든 내용들을 취소하고 DB를 이전 상태로 되돌리는 명령어

5. **SAVEPOINT** : 트랜잭션 내에 ROLLBACK 할 위치인 저장점을 지정하는 명령어

<br/><br/>

## **Section 074. SQL - DML**

1. **DML(데이터 조작어)** : DB 사용자가 응용 프로그램 or 질의어를 통해 저장된 데이터를 실질적으로 관리하는데 사용되는 언어

2. **삽입문** : 기본 테이블에 새로운 튜플을 삽입할 때 사용

   ```sql
   INSERT INTO 테이블명([속성명1, 속성명2, ...])
   VALUES (데이터1, 데이터2, ...);
   ```

3. **삭제문** : 기본 테이블에 있는 튜플들 중 특정 튜플(행)을 삭제할 때 사용함

   ```sql
   DELETE
   FROM 테이블명
   [WHERE 조건];
   ```

4. **갱신문** : 기본 테이블에 있는 튜플들 중 특정 튜플의 내용을 변경할 때 사용

   ```sql
   UPDATE 테이블명
   SET 속성명 = 데이터[, 속성명=데이터, ...]
   [WHERE 조건];
   ```

<br/><br/>

## **Section 074. DML - SELETE-1**

1. 일반 형식

   ```sql
   SELECT [PREDICATE] [테이블명.]속성명 [AS 별칭][, [테이블명.]속성명, ...]
   [, 그룹함수(속성명) [AS 별칭]]
   [, Window함수 OVER (PARTITION BY 속성명1, 속성명2, …
                         ORDER BY 속성명3, 속성명4, ...)]
   FROM 테이블명[, 테이블명, ...]
   [WHERE 조건]
   [GROUP BY 속성명, 속성명, ...]
   [HAVING 조건]
   [ORDER BY 속성명 [ASC | DESC]];
   ```

2. 기본 **검색** - DISTINCT, AS
3. 조건 지정 검색 - WHERE(AND, OR, LIKE, BETWEEN/AND, IS  NULL)
4. 정렬 검색 - ORDER BY(DESC, ASC)
5. 하위 질의 - 조건절에 주어진 질의를 먼저 수행하여 그 검색 결과를 조건절의 피연산자로 사용함
6. 복수 테이블 - 여러 테이블을 대상으로 검색을 수행

<br/><br/>

## **Section 076. DML - SELECT-2**

1. 일반 형식

   ```sql
   SELECT [PREDICATE] [테이블명.]속성명 [AS 별칭][, [테이블명.]속성명, ...]
   [, 그룹함수(속성명) [AS 별칭]]
   [, WINDOW함수 OVER (PARTITION BY 속성명1, 속성명2, …
                         ORDER BY 속성명3, 속성명4, ...) [AS 별칭]]
   FROM 테이블명[, 테이블명, …]
   [WHERE 조건]
   [GROUP BY 속성명, 속성명, ...]
   [HAVING 조건]
   [ORDER BY 속성명 [ASC | DESC]];
   ```

2. WINDOW 함수 - GROUP BY절을 이용하지 않고 함수의 인수로 지정한 속성을 범위로 하여 속성의 값을 집계함(PARTITION BY, ORDER BY)

3. 그룹 지정 검색 - GROUP BY, HAVING

<br/><br/>

## **Section 077.** **프로시저(Procedure)**

1. **프로시저** : 절차형 SQL을 활용하여 특정 기능을 수행하는 일종의 트랜잭션 언어. 호출을 통해 실행되어 미리 저장해 놓은 SQL 작업을 수행함

2. 프로시저 생성

   ```sql
   CREATE [OR REPLACE] PROCEDURE 프로시저명(파라미터)
   [지역변수 선언]
   BEGIN
         프로시저 BODY;
   END;
   ```

3. 프로시저 실행

   ```sql
   EXECUTE 프로시저명;
   EXEC 프로시저명;
   CALL 프로시저명;
   ```

4. 프로시저 제거

   ```sql
   DROP PROCEDURE 프로시저명;
   ```

<br/><br/>

## **Section 078.** **트리거****(Trigger)**

1. **트리거** : DB 시스템에서 데이터의 삽입(Insert), 갱신(Update), 삭제(Delete) 등의 이벤트(Event)가 발생할 때마다 관련 작업이 자동으로 수행되는 절차형 SQL

2. 트리거의 구성

   + DECLARE : 트리거의 명칭, 변수/상수, 데이터 타입을 정의하는 선언부
   + EVENT : 트리거가 실행되는 조건을 명시함
   + BEGIN / END : 트리거의 시작과 종료
   + CONTROL : 조건문 or 반복문이 삽입되어 순차적으로 처리됨
   + SQL : DML, DCL이 삽입되어 데이터 관리를 위한 조회, 추가, 수정, 삭제 작업을 수행함
   + EXCEPTION : BEGIN ~ END 안의 구문 실행 시 예외가 발생하면 이를 처리하는 방법을 정의함

3. 트리거의 생성

   ```sql
   CREATE [OR REPLACE] TRIGGER 트리거명 [동작시기 옵션][동작 옵션] ON 테이블명
   REFERENCING [NEW | OLD] AS 테이블명
   FOR EACH ROW
   [WHEN 조건식]
   BEGIN
          트리거 BODY;
   END;
   ```

4. 트리거의 제거

   ```sql
   DROP TRIGGER 트리거명;
   ```

<br/><br/>

## **Section 079.** **사용자** **정의** **함수**

1. **사용자** **정의** **함수** : 프로시저와 유사하게 SQL을 사용하여 일련의 작업을 연속적으로 처리하고, 종료 시 처리 결과를 단일값으로 반환하는 절차형 SQL

2. 사용자 정의 함수의 구성

   + DECLARE : 사용자 정의 함수의 명칭, 변수/상수, 데이터 타입을 정의하는 선언부
   + BEGIN / END : 트리거의 시작과 종료
   + CONTROL : 조건문 or 반복문이 삽입되어 순차적으로 처리됨
   + SQL : DML, DCL이 삽입되어 데이터 관리를 위한 조회, 추가, 수정, 삭제 작업을 수행함
   + EXCEPTION : BEGIN ~ END 안의 구문 실행 시 예외가 발생하면 이를 처리하는 방법을 정의함
   + RETURN : 호츨 프로그램에 반환할 값/변수를 정의

3. 사용자 정의 함수 생성

   ```sql
   CREATE [OR REPLACE] FUNCTION 사용자_정의_함수명(파라미터)
   [지역변수 선언]
   BEGIN
          사용자 정의 함수 BODY;
          RETURN 반환값;
   END
   ```

4. 사용자 정의 함수 실행

   ```sql
   SELETE 사용자_정의_함수명 FROM 테이블명;
   INSERT INTO 테이블명(속성명) VALUES (사용자_정의_함수명);
   DELETE FROM 테이블명 WHERE 속성명 = 사용자_정의_함수명;
   UPDATE 테이블명 SET 속성명 = 사용자_정의_함수명;
   ```

5. 사용자 정의 함수 제거

   ```sql
   DROP FUNCTION 사용자_정의_함수명;
   ```

<br/><br/>

## **Section 080.** **제어문**

1. **제어문** : 차례대로 진행되는 절차형 SQL의 진행 순서를 변경하기 위해 사용하는 명령문
2. **IF문** : 조건에 따라 실행할 문장을 달리하는 제어문
   + 형식1 : 조건이 참일 때만 실행함
   + 형식2 : 조건이 참일 때와 거짓일 때 실행할 문장이 다름
   + 형식3 : 조건이 여러 개일 때 각 조건마다 실행할 문장이 다름
3. **LOOP문** : 조건에 따라 실행할 문장을 반복 수행하는 제어문
   + 기본형 : EXIT WHEN 조건이 참일 때 반복 종료
   + FOR LOOP : 초기값 ~ 종료값까지 1씩 증가하며 실행할 문장을 반복 수행함
   + WHILE LOOP : 조건이 참인 동안 실행할 문장을 반복 수행함
4. **CONTINUE** : 반복문의 실행을 제어하기 위해 사용하는 예약어
5. **GOTO** : 원하는 위치로 이동하여 명령문을 수행하기 위해 사용하는 제어문

<br/><br/>

## **Section 081. 커서(Cursor)**

1. **커서** : 쿼리문의 처리 결과가 저장되어 있는 메모리 공간을 가리키는 포인터(Pointer)
2. **묵시적** **커서** - DBMS 자체적으로 열리고(Open) 패치(Fetch)되어 사용이 끝나면 닫히지만(Close) 커서의 속성을 조회하여 사용된 쿼리 정보를 열람하는게 가능함
3. **명시적** **커서** : 사용자가 직접 정의해서 사용하는 커서. 주로 절차형 SQL에서 SELETE문의 결과로 반환되는 여러 튜플들을 제어하기 위해 사용됨

<br/><br/>